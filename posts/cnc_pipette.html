<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.9.20">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2026-01-19">
<meta name="description" content="Moving small drops of liquid around under computer control, updates on the biolistics projects, bulk glowy gelatinous blobs, friction welding, beer brewing.">

<title>CNC Pipette, Misc Project Updates – johnowhitaker.dev</title>
<style>
/* Default styles provided by pandoc.
** See https://pandoc.org/MANUAL.html#variables-for-html for config info.
*/
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-7038d31925839fcd0b50e6237b0ff245.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-6abaf6d5b9fda6af941eff80e4231322.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
<meta name="twitter:title" content="CNC Pipette, Misc Project Updates – johnowhitaker.dev">
<meta name="twitter:description" content="Moving small drops of liquid around under computer control, updates on the biolistics projects, bulk glowy gelatinous blobs, friction welding, beer brewing.">
<meta name="twitter:image" content="https://johnowhitaker.dev/posts/images/cnc_pipette.png">
<meta name="twitter:creator" content="@johnowhitaker">
<meta name="twitter:card" content="summary">
<meta name="twitter:image-height" content="1572">
<meta name="twitter:image-width" content="1484">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../all.html"> 
<span class="menu-text">Everything Feed</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-more" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">More</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-more">    
        <li>
    <a class="dropdown-item" href="../tsbabn.html">
 <span class="dropdown-text">TSBABN</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../resume.html">
 <span class="dropdown-text">Resume: Jonathan Whitaker</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../books.html">
 <span class="dropdown-text">Book Recommendations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../blogs.html">
 <span class="dropdown-text">Blog Recommendations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../yt.html">
 <span class="dropdown-text">YouTube Channel Recommendations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../appearances.html">
 <span class="dropdown-text">Appearances</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../things.html">
 <span class="dropdown-text">Thing Recommendations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://johnowhitaker.dev/index.xml"><i class="bi bi-rss" role="img">
</i> 
 <span class="dropdown-text">RSS Feed</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../now.html">
 <span class="dropdown-text">Now</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://ln.johnowhitaker.com">
 <span class="dropdown-text">Lab Notes</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#cnc-pipette" id="toc-cnc-pipette" class="nav-link active" data-scroll-target="#cnc-pipette">CNC Pipette</a></li>
  <li><a href="#biolistics---asgg-tests" id="toc-biolistics---asgg-tests" class="nav-link" data-scroll-target="#biolistics---asgg-tests">Biolistics - ASGG tests</a></li>
  <li><a href="#biolistics---w-wire-tatoo-approach" id="toc-biolistics---w-wire-tatoo-approach" class="nav-link" data-scroll-target="#biolistics---w-wire-tatoo-approach">Biolistics - W wire tatoo approach</a></li>
  <li><a href="#tissue-culture" id="toc-tissue-culture" class="nav-link" data-scroll-target="#tissue-culture">Tissue Culture</a></li>
  <li><a href="#glowing-gelatinous-blobs" id="toc-glowing-gelatinous-blobs" class="nav-link" data-scroll-target="#glowing-gelatinous-blobs">Glowing Gelatinous Blobs</a></li>
  <li><a href="#misc-updates" id="toc-misc-updates" class="nav-link" data-scroll-target="#misc-updates">Misc Updates</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">CNC Pipette, Misc Project Updates</h1>
  <div class="quarto-categories">
    <div class="quarto-category">mini-hw-projects</div>
    <div class="quarto-category">bio</div>
  </div>
  </div>

<div>
  <div class="description">
    Moving small drops of liquid around under computer control, updates on the biolistics projects, bulk glowy gelatinous blobs, friction welding, beer brewing.
  </div>
</div>


<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 19, 2026</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>I had a productive weekend, and should write it all up! Many projects are simmering away with long waits before they resolve, so I’m dumping them all in this post :)</p>
<section id="cnc-pipette" class="level2">
<h2 class="anchored" data-anchor-id="cnc-pipette">CNC Pipette</h2>
<p>I’ve enjoyed hearing <a href="https://x.com/jrkelly">Jason Kelly</a>’s take on why bio should abandon the lab bench and let automated labs (like the ones his company Ginkgo makes) do the work of moving liquids and things around, freeing up the smart minds to actually think about cool experiments rather than spending all their time on menial lab tasks. Sounds good, although I simultaneously think far more people should do a little lab stuff to open their minds to the realities of the real world, and worry how much might get missed if you only see what you set out to measure!</p>
<p>Anyway, with all that discussion fresh in my mind, one of the things I did this weekend was whip up an attachment for my 3D printer that holds my pipette and can suck up and dispense small amounts of liquid. End goal: agar art with colorful microbes, of course :D A Dynamixel servo that I had on hand pushes the plunger thingee on the pipette, with both it and the printer controlled by a raspberry pi or laptop (the latter after I ran the wrong G-Code and spilled colorful water on the former!).</p>
<p><img src="images/cnc_pipette.png" class="img-fluid"></p>
<p>The <a href="https://cad.onshape.com/documents/42cf135ce4b1a1a34746c4ee/w/bec91f2a6df1f3690807754b/e/2f528fdceb0af6a3583d11d3?renderMode=0&amp;uiState=696e7b486f2ab6c24a30a134">CAD</a> and <a href="https://github.com/johnowhitaker/pipette">code</a> are still WIP, contact me if you’re interested in this or wait until the next weekend I feel like tidying it up + making a more thorough video documenting the project. My favourite result so far comes from the first test, before I dialed in liquid dispensing:</p>
<p><img src="images/cnc_p_heart.png" class="img-fluid"> <img src="images/cnc_p_heart_result.png" class="img-fluid"></p>
<p>I’ve since done some agar art with my pet blue fluorescent Pseudomonas sp. that is growing out nicely - will upload pics once I make a few more artworks.</p>
<p>Update: I made a short with it in action: <a href="https://www.youtube.com/shorts/He5VJz9E1lQ">https://www.youtube.com/shorts/He5VJz9E1lQ</a></p>
</section>
<section id="biolistics---asgg-tests" class="level2">
<h2 class="anchored" data-anchor-id="biolistics---asgg-tests">Biolistics - ASGG tests</h2>
<p>I haven’t managed to find a way to get genes from addgene. A friend has kindly stepped in to help, and I might also cold-email some local profs in case any want to collaborate. But that means than for now, I don’t really have a way to test the gene gun idea and won’t for a few more weeks at least. Still, I did muck about a bit, starting with: carriers and DNA adhesion.</p>
<p>In regular gene guns, DNA is precipitated onto gold nanoparticles, which are then washed in ethanol and then mixed with something called PVP, which let’s them then stick to plastic tubes or disks. The result is an even spread of DNA-coated gold balls. I’m planning to try a few things differently. One carrier I’m looking at is diatomaceous earth - sharpish fragments about the right size, high surface area. I’ve been putting little droplets of DE slurry on film (cling film or parafilm) and firing them without even waiting for the droplet to dry.</p>
<p>One test was thus, can we stick DNA to DE? Both are ~slightly negatively charged, so I tried one test with DE slurry + plasmid soln (my ~failed BLY_GREEN) w/ methylene blue to stain the DNA + water, and a second with the same but 50mM CaCL2 solution instead of water. The CaCl2 contributes +ve calcium ions which might (the theory goes) form a bridge. Indeed, it seemed like the DE that settled out in the CaCl2 version was bluer than the whiteish version with just water. (A better test would be to use a better DNA stain to check the water bit to see how much DNA is left). In another test, DE mixed with DNA + MB both with and without CaCl2 was added to lots more water and then spun down in a diy centrifuge - the pellet in both was blue, but the water-only pellet rapidly disperse on handling while the CaCl2 version was stable - my suspicion is that it causes clumping (pro gene gun prep involves sonicating to break up clumps). If that’s the case, then skipping the CaCl2 might be better - the DNA is still likely to coat the carrier if e.g.&nbsp;we let a drop evaporate and it is left with tons of surface area of silica DE vs a relatively small area of hydrophobic cling-film. More testing to do :)</p>
<p><img src="images/blue_de.png" class="img-fluid"></p>
<p>I also explored penetration. My first attempt just had a wide attachment after the barrel, with film stretched across it. You had to get close to get much penetration, which also seemed to cause damage to the agar at least (using it as a transparent stand-in for plant matter). Testing it on onion it mostly penetrated only the 1st layer of cells. So, I modelled up a converging-diverging nozzle, with the film placed in the throat, and got much nicer results - less damage from air, more even penetration of the (presumably faster-moving) particles. In onion it sent some particles 5-10 cells deep on the first try :)</p>
<p><img src="images/pen_test_mb.png" class="img-fluid"></p>
</section>
<section id="biolistics---w-wire-tatoo-approach" class="level2">
<h2 class="anchored" data-anchor-id="biolistics---w-wire-tatoo-approach">Biolistics - W wire tatoo approach</h2>
<p>I did more tests with my mini tatoo gun concept, using a bundle of flame-sharpened tungsten wires (50-micron) to poke at an onion with some MB as a dye just to see what happens. The dye wipes away except where the wires (attached to an electric toothbrush) stabby-stabby stabbed the tissue.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/wneedlebundle.png" class="img-fluid figure-img"></p>
<figcaption>A bundle of tungsten wires, partially flame-sharpened</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/wneedle_results.png" class="img-fluid figure-img"></p>
<figcaption>Most of the effect is in the top layer of cells</figcaption>
</figure>
</div>
<p>The wire is perhaps too flexible, and rapidly gets bent without penetrating much beyond the first layer - perhaps I should have started from thicker wire. Still, with some fiddling it seemed to eventually yield a setup that got some poki-ness happening. We’ll see how it goes when I can try it with some actual DNA.</p>
</section>
<section id="tissue-culture" class="level2">
<h2 class="anchored" data-anchor-id="tissue-culture">Tissue Culture</h2>
<p>As for what we’ll actually transform, and how we’ll grow out plants from a few transformed cells, I’ve been exploring tissue culture a little. Most of my experiments so far ended in contamination - some from an early media test just heating the media up to 96C rather than microwaving or autoclaving (which left one or two live spores or something per tub, nothing if you’re doing a petri dish of bacteria for a few days, a dead pain if you’re wanting to grow a piece of plant matter for months) but most from the explants themselves; it turns out you need really aggressive sterilization with bleach etc to kill everything but the plant tissue (and in the process you usually do kill a fair bit of the plant tissue too). Might try some other options soon.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/tc_update.png" class="img-fluid figure-img"></p>
<figcaption>Sterilizing TC media in an Instapot</figcaption>
</figure>
</div>
<p>Anyway, now that I’ve switched to media sterilized in an Instapot and started being more aggressive with the explant sterilization, I feel like I’m slowly taming the beast. It’s all super slow though - aaaah my poor software brain is spoiled from same-second results :D</p>
</section>
<section id="glowing-gelatinous-blobs" class="level2">
<h2 class="anchored" data-anchor-id="glowing-gelatinous-blobs">Glowing Gelatinous Blobs</h2>
<p>I grow some of the <a href="https://johnowhitaker.dev/posts/pseudomonas.html">Pseudomonad I isolated</a> in ~500ml of ‘marmite broth’ in a flask, with parafilm cover and occasional stirring. Then I added 1g CaCl2 to it, and dripped it into some water with sodium alginate - something the molacular gastronomy folks call ‘reverse spherification’. The result is gooey blobs, which (thanks to all the pyoverdine the bacteria made) glow bright blue under UV light. I pictured cool fluorescent spheres I could sprinkle around the base of our plants, to provide them with a bacterial iron boost (but mostly for aesthetics). What I got was more of a congealed mess, but it was fun nonetheless.</p>
<p><img src="images/glowgoo.png" class="img-fluid"></p>
<p>Handling the containers (post boiling + alcohol steriliation) stained my hands a lovely fluorescent yellow-green, some cool modification of the blue-fluorescing molecule(s) this makes. Neat! Invisible under regular light, and now mostly gone after a day of occasional washes and a shower.</p>
</section>
<section id="misc-updates" class="level2">
<h2 class="anchored" data-anchor-id="misc-updates">Misc Updates</h2>
<ul>
<li><p>Ran some Thai Tea concentrate (low C) and Puerh (very high C for tea) through caffeine TLC process</p></li>
<li><p>Tried friction welding 3D prints with a dremel, cool technique!</p></li>
</ul>
<p><img src="images/friction_weld.png" class="img-fluid"></p>
<ul>
<li>Made a batch of beer from a kit - turned out extremely well, fermentation was stalled in my cold basement until I warmed it to 22C. Friends all agreed it was tasty, but none of us really like beer so I threw out most of it - sorry! Now the brew tank is destined for more exotic projects :D</li>
</ul>
<p>OK that’s about enough typing for now, apoligies for a lower-effort post but I figure better to document some stuff now rather than try to remember it all in months time when I start getting more final results on things.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/johnowhitaker\.dev");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>