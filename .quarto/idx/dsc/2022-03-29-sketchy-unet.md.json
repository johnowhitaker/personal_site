{"title":"Sketchy Unet","markdown":{"yaml":{"title":"Sketchy Unet","date":"2022-03-29"},"headingText":"Finding a dataset","containsRefs":false,"markdown":"\n\n![](https://datasciencecastnethome.files.wordpress.com/2022/03/screenshot-from-2022-03-29-10-31-48.png?w=946)\n\nThe [model demo running on Huggingface Spaces](https://huggingface.co/spaces/johnowhitaker/sketchy_unet_demo)\n\nI wanted a fast way to go from an image to something like a rough charcoal sketch. This would be the first step in a longer pipeline that would later add detail and colour, so all it has to do is give a starting point with the right sort of proportions.\n\n\nI found a small dataset that seemed like a good starting point (originally created in '[APDrawingGAN: Generating Artistic Portrait Drawings From Face Photos With Hierarchical GANs](https://openaccess.thecvf.com/content_CVPR_2019/html/Yi_APDrawingGAN_Generating_Artistic_Portrait_Drawings_From_Face_Photos_With_Hierarchical_CVPR_2019_paper.html)' by Ran Yi, Yong-Jin Liu, Yu-Kun Lai, Paul L. Rosin). It's quick to download, and (with a little datablock wrangling) easy enough to load with fastai. See [the notebook](https://colab.research.google.com/drive/1ydcC4Gs2sLOelj0YqwJfRqDPU2sjQunb?usp=sharing) for details.\n\n## Training the model\n\nI chose to model this as an image-to-image task, and used fastai's `unet_learner` function to create a [U-net style](https://arxiv.org/abs/1505.04597) network based on a Resnet34 backbone. Starting with 128px images and then moving up to 224px, the model is trained to minimise the MSE between the output and the reference sketch. In about 3 minutes (!!) we end up with a model that is doing pretty much exactly what I want:\n\n![](https://datasciencecastnethome.files.wordpress.com/2022/03/screenshot-from-2022-03-28-19-06-20.png?w=648)\n\nImages (left), artist's sketch (center), model outputs (right)\n\n## Sharing a Demo\n\nI've been playing around with HuggingFace Spaces recently, and this model was a great candidate for a simple demo that should run reasonably fast even on a CPU (like those provided by Spaces). At the end of [the training notebook](https://colab.research.google.com/drive/1ydcC4Gs2sLOelj0YqwJfRqDPU2sjQunb?usp=sharing) you can see the gradio interface code. Very user-friendly for these quick demos! The [trained model was uploaded to huggingface](https://huggingface.co/johnowhitaker/sketchy_unet_rn34) as well, and they somehow detected that my code was downloading it because it shows up as a 'linked model' from [the space](https://huggingface.co/spaces/johnowhitaker/sketchy_unet_demo).\n\nIt's neat that I can so easily share everything related to a mini-project like this for others to follow along. The [colab notebook](https://colab.research.google.com/drive/1ydcC4Gs2sLOelj0YqwJfRqDPU2sjQunb?usp=sharing) provides a free cloud environment to replicate training, the [model](https://huggingface.co/johnowhitaker/sketchy_unet_rn34) is hosted by someone with lots of bandwidth and is easy to download, and [the demo](https://huggingface.co/spaces/johnowhitaker/sketchy_unet_demo) needs no technical skills and lets anyone try it out in seconds. Hooray for fastai, gradio, huggingface and so many others who work so hard to make our lives easy :)\n\n## Update: What's this for?\n\n![](https://datasciencecastnethome.files.wordpress.com/2022/04/screenshot-from-2022-03-31-14-19-42.png?w=978)\n\nWaterface demo: https://huggingface.co/spaces/johnowhitaker/waterface\n\nI used this model to 'sketchify' images before loading them into an imstack and optimising that to match a CLOOB prompt like 'A charcoal and watercolor sketch of a person'. After a few steps the result looks pretty OR more likely a little creepy. Ah, the power of AI :) Try it out [here](https://huggingface.co/spaces/johnowhitaker/waterface).\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"markdown"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../styles.css"],"toc":true,"output-file":"2022-03-29-sketchy-unet.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.2.335","theme":"cosmo","title":"Sketchy Unet","date":"2022-03-29"},"extensions":{"book":{"multiFile":true}}}}}