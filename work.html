<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.14">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Work With Me – johnowhitaker.dev</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-98bfa626b1068186620cc14e15ad040c.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-e6128a8dd8baae5317a81e4c84a7f45b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
<meta name="twitter:title" content="Work With Me – johnowhitaker.dev">
<meta name="twitter:description" content="">
<meta name="twitter:creator" content="@johnowhitaker">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./all.html"> 
<span class="menu-text">Everything Feed</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-more" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">More</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-more">    
        <li>
    <a class="dropdown-item" href="./tils.html">
 <span class="dropdown-text">TILs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./blog.html">
 <span class="dropdown-text">Blog Archive</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./tsbabn.html">
 <span class="dropdown-text">TSBABN</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./resume.html">
 <span class="dropdown-text">Resume: Jonathan Whitaker</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./books.html">
 <span class="dropdown-text">Books</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./blogs.html">
 <span class="dropdown-text">Blogs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./yt.html">
 <span class="dropdown-text">YouTube Channel Recommendations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./appearances.html">
 <span class="dropdown-text">Appearances</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://johnowhitaker.dev/index.xml"><i class="bi bi-rss" role="img">
</i> 
 <span class="dropdown-text">RSS Feed</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#availability-and-rates" id="toc-availability-and-rates" class="nav-link active" data-scroll-target="#availability-and-rates">Availability and Rates</a></li>
  <li><a href="#examples" id="toc-examples" class="nav-link" data-scroll-target="#examples">Examples</a></li>
  <li><a href="#preferences" id="toc-preferences" class="nav-link" data-scroll-target="#preferences">Preferences</a></li>
  <li><a href="#why-not-full-time" id="toc-why-not-full-time" class="nav-link" data-scroll-target="#why-not-full-time">Why Not Full-Time?</a></li>
  <li><a href="#self-funded-research" id="toc-self-funded-research" class="nav-link" data-scroll-target="#self-funded-research">Self-funded Research</a></li>
  <li><a href="#a-note-on-salaries-from-the-perspective-of-a-zimbabwean" id="toc-a-note-on-salaries-from-the-perspective-of-a-zimbabwean" class="nav-link" data-scroll-target="#a-note-on-salaries-from-the-perspective-of-a-zimbabwean">A note on salaries from the perspective of a Zimbabwean</a></li>
  <li><a href="#closing-thoughts" id="toc-closing-thoughts" class="nav-link" data-scroll-target="#closing-thoughts">Closing Thoughts</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Work With Me</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Update 2024: I work at answer.ai doing R&amp;D now. I’m not available for other work. This job ticks most of the boxes I was aiming for with the benefit of being a real job :) I am very grateful we got to start this and pull together such an amazing bunch of people.</p>
<p>I tend to describe myself as a ‘Data Scientist’, ‘AI Researcher’, ‘Independent Researcher’ or ‘Consultant’. On this page, I’m going to try to explain how you might engage my services under one of those umbrellas, and also share my thoughts on work and how I’m trying to make the ‘Independent Researcher’ one feasible. See also, my more typical <a href="./resume.html">resume page</a></p>
<section id="availability-and-rates" class="level2">
<h2 class="anchored" data-anchor-id="availability-and-rates">Availability and Rates</h2>
<p>Current availability as of November 2023: I’m reluctantly open to part-time work up to ~20 hours/week for the next few months.</p>
<p>Current rate: ~$300/hour depending on project length.</p>
<p>In general, I’ll almost always be available for short one-off calls or mini-projects. Due to the nature of consulting and the unpredictability of clients, it’s a lot harder to guarantee longer-term availability - please reach out rather than trusting the (possibly stale) info above.</p>
</section>
<section id="examples" class="level2">
<h2 class="anchored" data-anchor-id="examples">Examples</h2>
<p>To give you an idea of the kinds of work I like to do and the types of engagement I’ve found to work well, here is a list of examples that you can reference, from small to big</p>
<ul>
<li><p>You politely email/DM me with a technical question. I respond, possibly getting nerd-sniped by something interesting. Cost: free</p></li>
<li><p>You’d like me to join a one-off call, ~1h, to get my thoughts or input. Cost: $500</p></li>
<li><p>You’d like me to give a talk. I’m a sucker for chances to talk about things I’m interested in, but these also generally take a lot more time than I would anticipate. Cost: ~6-24 hours, less if it sounds fun, less if I can share a recording publically, less if it’s a good cause.</p></li>
<li><p>You’d like me to run some training sessions or to provide technical assistance to get your team up to speed on something. Great! This is a format I’m less familiar with and cost would be highly dependent on the project, but likely 10+ hours per 1h contact time.</p></li>
<li><p>You have a specific problem or project related to my expertise. We meet and it sounds doable. I spend 20 hours over two weeks delivering a demo solution. Cost: 20 hours</p></li>
<li><p>You have a research question and would like me to spend time looking at it. Perhaps you’d like me to explore how some new method applies to your domain, or to try and invent some novel solution to a problem you’re facing. R&amp;D is much harder to predict ahead of time, so I tend to work on ‘the best I can do in timeframe X’ rather than promising deliverables. I’d likely suggest a more flexible staged approach: 20 hours to look into it, then meet and decide to spend another month pushing for some specific outcomes, and then plan further from there.</p></li>
<li><p>You’d like me to join your team for the next 6 months to work on multiple research questions. Cost 3 days * 8 hours per week, rate negotiable</p></li>
</ul>
</section>
<section id="preferences" class="level2">
<h2 class="anchored" data-anchor-id="preferences">Preferences</h2>
<p>I like being useful (“delivering value”). I like learning and teaching. I like solving technical problems. I like working on things that feel meaningful. Since I’m not highly motivated by money (see later sections) we’re much more likely to end up working together if said work aligns with at least some of these preferences.</p>
</section>
<section id="why-not-full-time" class="level2">
<h2 class="anchored" data-anchor-id="why-not-full-time">Why Not Full-Time?</h2>
<p>While I’m not completely closed to the idea of taking a full-time position somewhere, there are a few reasons I’m reluctant to do so:</p>
<ul>
<li><p>My productivity tends to fluctuate. There are times when I feel extremely productive and times when I can’t get much done. Hitting the latter when someone is paying me a salary feels wrong! Perhaps naive, but I just don’t have the kind of mindset that can sit back and take a salary I don’t feel is deserved.</p></li>
<li><p>Being able to dial up or down the amount of work I have on my plate is the most effective solution to burnout and depression that I’ve found. A clear end in sight makes all the difference when facing a slump!</p></li>
<li><p>I’ve become rather attached to having time to pursue my projects and research ideas. Having ‘free time’ to create free resources, learn new things, or pursue non-tech passions and interests is fantastic. More on this in the next section…</p></li>
</ul>
<p>Of course, there are perks to having a consistent employer too - health insurance, stability and the friends and mentors that would come with a team chief among them. I’ve toyed with looking for “full-time part-time” work (say, 3 days/week) which might balance the best of both worlds. If you have ideas on this front, let me know!</p>
</section>
<section id="self-funded-research" class="level2">
<h2 class="anchored" data-anchor-id="self-funded-research">Self-funded Research</h2>
<p>I’ve spoken with several smart people recently who’ve all said variants of the same things:</p>
<ul>
<li>they feel they do best at ~4h/day of focused creative work (on average)</li>
<li>they’d love some time off to pursue their own cool ideas</li>
<li>their previous experiences of sabbaticals / “research holidays” have always led to even better opportunities down the road</li>
</ul>
<p>“Wouldn’t it be nice if some rich person would just give us money to do cool s***” we joke. “Yeah, like a patron! Maybe some aristocrat would let me live in their hermitage with a rack of GPUs to play with…”. The truth is, for those of us privileged enough to be working in this lucrative field, being that patron for yourself is potentially doable!</p>
<p>I’ve been doing something like this my whole career, and it’s working out so far. Let’s explore why more people aren’t doing this (yet) and then I’ll share my own experience and tips.</p>
<section id="obstacle-1-realizing-this-is-even-an-option" class="level4">
<h4 class="anchored" data-anchor-id="obstacle-1-realizing-this-is-even-an-option">Obstacle 1: realizing this is even an option</h4>
<p>Should I join/start a start-up or work at a big co? Move to SF and work at FAANG or get a bigger house in cheaper city X and take a remote role with a pay cut? Retire at 50 or 70? These are NOT your only choices! Looking past the traditional paths requires a pretty heavy mindset shift.</p>
</section>
<section id="obstacle-2-accepting-the-opportunity-cost" class="level4">
<h4 class="anchored" data-anchor-id="obstacle-2-accepting-the-opportunity-cost">Obstacle 2: accepting the opportunity cost</h4>
<p>People make insane amounts of money working at big tech companies. My mind explodes when I hear the salaries. Giving that up seems crazy! Maybe it is, but consider that many of those people want more $ so they can eventually, one day, maybe, have time to do what they <em>really</em> want to do. If you can skip straight to that end goal, then perhaps it’s not so crazy…</p>
</section>
<section id="obstacle-3-what-if-this-means-i-cant-go-back" class="level4">
<h4 class="anchored" data-anchor-id="obstacle-3-what-if-this-means-i-cant-go-back">Obstacle 3: what if this means I can’t go back?</h4>
<p>Your resume might be less typical, but on the other hand, the growth I’ve seen exploring these alternate paths is a lot higher than I’d have gotten with N years at a single company. Others I’ve spoken to have had the same experience - finding new opportunities and clients based on their curiosity-driven side projects. As one good friend put it: “That’s the magic of farting [around]”.</p>
<p>The larger danger might be that you can’t go back because it’s too nice! Consider this quote from Simon Willison’s recent <a href="https://simonwillison.net/2023/Nov/10/universe/">talk on ‘Financial sustainability for open source projects’</a>:</p>
<blockquote class="blockquote">
<p>So I got paid to spend a year working on my open source projects, which, with hindsight, completely ruined me. Because once you’ve got to spend a year just working on the things you want to work on, it’s very difficult to accept somebody else stepping in telling you to work on other things instead.</p>
<p>Since that fellowship ended, I’ve been mainly living off savings and occasionally picking up bits of consulting work— and trying to keep that ball rolling, because I’m enjoying myself so much.</p>
</blockquote>
<p>Simon is incredibly productive and inspiring - I really hope he can continue to make it work from him, and that more people can try this out!</p>
</section>
<section id="my-experience" class="level4">
<h4 class="anchored" data-anchor-id="my-experience">My Experience</h4>
<p>In 2014, fresh out of high school, I did some work on several ecology-related projects as the ‘computer guy’ - modeling species distributions, doing the mapping/GIS, trying some ML stuff on satellite data, lots of stats and data viz.&nbsp;A consequence of this was that throughout my time at University I had occasional parcels of work coming my way, providing a trickle of pocket money and a portfolio that helped me land a contract with a Data Science consulting company sometime in my third year. That went well enough that by the time I finished my studies a year later, I had some decent savings and a good (if small) network of contacts. I got married and moved back to Zimbabwe, where our plan was to extend the honeymoon until the money ran out. It didn’t! I kept getting chunks of work that more than covered our minimal (~$600/month) COL.</p>
<p>Towards the end of 2020 I was working one half-time job and juggling a few other contracts - I’d said yes to too much, and ended up burning out. Shout out to Zindi for being the most epic and understanding employer ever. I quit all the things and took a few months completely off, spending a lot of time outdoors. It was phenomenal being able to take that time to recover, and then to sloooowly ease back into coding over the next year or two beginning with things that seemed fun. My wife’s local income plus our savings removed a lot of pressure. And amusingly the dabbles with (at that time) nice and ‘silly’ topics like AI-generated images and such ended up giving me a few years head-start on the generative AI craze, which has been rather convenient!</p>
<p>This year has been pretty atypical, with a move to the US and lots of family-related travel, but I’m slowly settling into a routine: a chunk of consulting comes through, then I take a break, then I dabble with personal projects, then someone reaches out with more work… rinse and repeat. Projects range from a one-week implementation of some specific idea all the way up to my 5-month stint as a part-time ‘Builder In Residence’ with PlaygoundAI working on a whole bunch of projects. On the side, I’ve been ‘researching with friends’ (a nice change from the solo stuff) in a collaboration that started late last year when I teamed up with some fellow nerds to make part 2 of the fast.ai course, diving into diffusion models.</p>
<p>The majority of my time is spent on non-income-generating activities - making courses/videos, trying out projects based on research questions or idle curiosity, spending lots of time with family, and trying to stay current with the firehose of research coming out each week in this field.</p>
<p>It feels a little precarious (and extremely privileged) to rely on usually having a queue of potential clients hanging around, but for now there seems to be enough demand to keep me as busy as I want to be. I don’t have enough data to tell yet how sustainable this will be long-term with the higher costs associated with living here in the US, but I’ve met enough friends in similar situations making it work that I’m hopeful! Stay tuned for updates :)</p>
</section>
</section>
<section id="a-note-on-salaries-from-the-perspective-of-a-zimbabwean" class="level2">
<h2 class="anchored" data-anchor-id="a-note-on-salaries-from-the-perspective-of-a-zimbabwean">A note on salaries from the perspective of a Zimbabwean</h2>
<p>Any discussion of salaries and rates in this industry blows my mind. To give you an idea of some of my reference points:</p>
<ul>
<li>A rural farm laborer in Zimbabwe might earn $60 a month</li>
<li>A teacher at the fanciest private school maybe $1,200 per month, which is enough to live a comparatively lavish life in the capital city</li>
<li>My first ‘Data Science’ gig in SA was something like $500/week (extreme riches to a student) and later work probably peaked more like $500/day (call it $60/hour). It felt (and still feels) almost obscene to get more for a days coding than many in the country make in a year.</li>
</ul>
<p>So, as you can imagine, salaries in the AI space (where TC at big players can run to 7 figures) actually melt my brain. To date, my strategy is to reluctantly up my rates when I have to, to think about it as little as possible, and to send lots of money back home to spread it around more in places where the dollars go a lot further :)</p>
</section>
<section id="closing-thoughts" class="level2">
<h2 class="anchored" data-anchor-id="closing-thoughts">Closing Thoughts</h2>
<p>I feel extremely fortunate to have had the space to explore this virtuous “fart around with something cool &lt;-&gt; get more cool work &lt;-&gt; fund more time” cycle. Long term I may decide I need to focus on something more specific for a longer period to have a larger impact, but for the current fast-moving and fast-changing landscape this seems to have been a pretty optimal choice. I should mention that I’m still thinking through a lot of this (this post was one way to do that) and may revise these ideas soon. If you have thoughts or ideas on this I’d love to hear them! In the meantime, he experiment continues…</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/johnowhitaker\.dev");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>